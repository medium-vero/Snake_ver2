#include <windows.h>
#include <stdio.h>
#include<time.h>
#include<conio.h>
int toa_dox[100] = { 0 };
int toa_doy[100] = { 0 };
int sl = 1;
int xqua = -1;
int yqua = -1;
int speed=100;
int score=1; //tinh diem
int snakecolor=1;  // xu li phan doi mau lien tuc cho con ran khi an qua
int luachoncu,luachonmoi; // xu li phan menu
int dem=0;
void gotoXY(int x, int y){   // ham di chuyen den toa do (x,y) tren man hinh
  static HANDLE h = NULL;  
  if(!h)
    h = GetStdHandle(STD_OUTPUT_HANDLE);
  COORD c = { x, y };  
  SetConsoleCursorPosition(h,c);
}
void SetColor ( int code ){   // ham chinh mau chu
    HANDLE color = GetStdHandle(STD_OUTPUT_HANDLE);
    SetConsoleTextAttribute( color , code );
}
void Nocursortype(){     // ham xoa con tro chuot tren man hinh console
	CONSOLE_CURSOR_INFO Info;
	Info.bVisible = FALSE;
	Info.dwSize = 20;
	SetConsoleCursorInfo(GetStdHandle(STD_OUTPUT_HANDLE), &Info);
}
void ve_tuong(){
	for (int x = 10;x <= 95;x++){
		gotoXY(x, 1);
		putchar(223); //printf("+");
		gotoXY(x, 25);
		putchar(220); //printf("+");
	}
	for (int y = 1;y <= 25;y++){
		gotoXY(10, y);
		putchar(219); //printf("+");
		gotoXY(95, y);
		putchar(219); //printf("+");
	}
}
void khoi_tao_ran(){
	int x_khoi_tao = 50;
	int y_khoi_tao = 13;
	for (int i = 0;i < sl;i++){
		toa_dox[i] = x_khoi_tao--;
		toa_doy[i] = y_khoi_tao;
	}
}
void ve_ran(){
	for (int i = 0;i < sl;i++){
		gotoXY(toa_dox[i], toa_doy[i]);
		if (i == 0){
			printf("O");  //head
		}
		else{
			printf("O"); // body
		}
	}
}
void di_chuyen_ran(int x,int y){
	//them x,y vao dau toadox,toadoy
	for (int i = sl;i > 0;i--){
		toa_dox[i] = toa_dox[i-1];
		toa_doy[i] = toa_doy[i-1];
	}
	toa_dox[0] = x;
	toa_doy[0] = y;
}
bool kt_ran_cham_than(){
	for (int i = 1;i <= sl;i++){
		if (toa_dox[0] == toa_dox[i] && toa_doy[0] == toa_doy[i]){
			return true;
		}
	}
	return false;
}
bool game_over(){
	if (toa_dox[0] == 10 || toa_dox[0] == 95 || toa_doy[0] == 1 || toa_doy[0] == 25){
		return true;
	}
	return kt_ran_cham_than();
}
bool kt_ran_de_qua(){
	for (int i = 0;i < sl;i++){
		if (xqua == toa_dox[i] && yqua == toa_doy[i]){
			return true;
		}
	}
	return false;
}
void tao_qua(){
	do{
		xqua = rand() % (93 - 12 + 1) + 12; // (94 - 11 + 1) + 11
		yqua = rand() % (24 - 2 + 1) + 2;   //	(25 - 1 + 1) + 1
	}while(kt_ran_de_qua());
}
void ve_qua(){
	gotoXY(xqua, yqua);
	SetColor(6);
	printf("$");
}
bool kt_ran_an_qua(){
	return (toa_dox[0] == xqua && toa_doy[0] == yqua);
}
void xu_ly_ran_an_qua(){
	if (kt_ran_an_qua()){
		sl++;      //tang dot
		tao_qua(); //tao qua moi
		ve_qua();
		score++;   //tang diem
		SetColor(snakecolor);
		snakecolor++;
		if(snakecolor==16){
			snakecolor=1;
		}
	}
}
void vaogame(){
	srand(time(NULL));
	SetColor(11);
	ve_tuong();
	khoi_tao_ran();
	tao_qua();
	ve_qua();
	int x = toa_dox[0];
	int y = toa_doy[0];
	int check = 2;//0: di xu?ng
				//1: di lên
				//2: di qua ph?i
				//3: di qua trái
	//------ play ----
	while (true){
		gotoXY(toa_dox[sl], toa_doy[sl]);
		printf(" ");
		//------ in ----
		ve_ran();
		//control snake
		if (_kbhit()){
			char c = _getch();
			if (c == -32){
				c = _getch();
				if (c == 72 && check != 0){
					check = 1;
				}
				else if (c == 80 && check != 1){
					check = 0;
				}
				else if (c == 75 && check != 2){
					check = 3;
				}
				else if (c == 77 && check != 3){
					check = 2;
				}
			}
		}
		//------ di chuy?n ---
		if (check == 0){
			y++;
		}
		else if (check == 1){
			y--;
		}
		else if (check == 2){
			x++;
		}
		else if (check ==3){
			x--;
		}
		gotoXY(100,2);
		printf("SCORE : %d",score);
		if (game_over()){
			gotoXY(48,12);
			SetColor(13);
			printf("YOUR SCORE : %d   \n",score);
			break;
		}
		xu_ly_ran_an_qua();
		di_chuyen_ran(x,y);
		Sleep(speed); // toc do
	}
	gotoXY(28,13);
	SetColor(4);
}
void menu(int luachoncu, int luachonmoi){
	while(1){
		if(dem!=0){
			SetColor(7);
		}
		system("cls");
		Nocursortype(); // ham an con tro chuot tren man hinh console
		gotoXY(52,1);
		printf("SNAKE GAME");             
		gotoXY(53,4);
		printf("1.PLAY");
		gotoXY(53,5);
		printf("2.HELP");
		gotoXY(53,6);
		printf("3.SETTING");
		gotoXY(53,8);
		printf("CHOICE : ");
		while(1){
			scanf("%d",&luachoncu);
			switch(luachoncu){ 
				case 1: // vao game
					system("cls");
					vaogame();
					gotoXY(40,14);
					printf("Press 3 and ENTER to return to the menu : ");
					scanf("%d",&luachonmoi);
					dem++;
					break;
				case 2: //huong dan
					system("cls");
					gotoXY(50,4);
					printf("Use arrow keys to move");
					gotoXY(50,5);
					printf("When the snake hits the wall, you lose");
					gotoXY(50,6);
					printf("Press 3 and ENTER to return to the menu");
					gotoXY(50,8);
					printf("CHOICE : ");
					scanf("%d",&luachonmoi);
					break;
				case 3: //cai dat toc do
						while(1){	
							system("cls");
							gotoXY(50,4);
							printf("The snake is moving at a speed of %d",speed);
							gotoXY(50,5);
							printf("Press 1 to increase the snake's speed by 10 ");
							gotoXY(50,6);
							printf("Press 2 to decrease the snake's speed by 10 ");
							gotoXY(50,7);
							printf("Press 3 and ENTER to return to the menu");
							gotoXY(50,9);
							printf("CHOICE : ");
							scanf("%d",&luachonmoi);
							if(luachonmoi==1){
								speed=speed-10;
							}	
							if(luachonmoi==2){
								speed=speed+10;
							}
							if(luachonmoi==3)
								break;
						}	
							break;
			}
			if(luachonmoi==3){
				break;
				SetColor(7);
				menu(luachoncu,luachonmoi);
			}
		}
	}
}
int main(){
		menu(luachoncu,luachonmoi);
}
